# Copyright (c) 2024 Nuvoton Technology Corporation.
# SPDX-License-Identifier: Apache-2.0

description: |
  The Nuvoton pin controller is a singleton node responsible for controlling
  pin function selection and pin properties. For example, you can use these
  nodes to select peripheral pin functions.

  Here is a list of supported standard pin properties:
    - bias-pull-down: Enable pull-down resistor.
    - bias-pull-up: Enable pull-up resistor.

  An example for the NPCM4 family, include the chip-level pinctrl DTSI file in the
  board-level DTS:

    #include <nuvoton/npcm/npcm4/npcm4-pinctrl.dtsi>

  We want to use the I2C0_0 port of the NPCM400F controller and enable the
  internal 3.3V pull-up if its I2C frequency won't exceed 400kHz.

  To change a pin's pinctrl default properties, add a reference to the pin in
  the board's DTS file and set the properties in the child node of pinctrl as below:

    i2c1a_scl_sda_gpio60_61: periph-i2c1a {
      pupd {
        bias-pull-up; /* Enable internal pull-up for i2c0_0 */
        periph-pupd = <NPCM_PINCTRL_DEVPU0_0_SMB1A_PUE>; /* Pull-up config for i2c0_0 */
      };
      scl {
        pinmux = <GPIO60__RSTOUT2__SCL1A 2>;
      };
      sda {
        pinmux = <GPIO61__RSTOUT1__SDA1A 2>;
      };
    };

    &i2c0_0 {
      pinctrl-0 = <&i2c1a_scl_sda_gpio60_61>;
      pinctrl-names = "default";
    };

compatible: "nuvoton,npcm-pinctrl"

include: base.yaml

properties:
  reg:
    required: true

child-binding:
  description: |
    The NPCM pin controller pinmux configuration node is responsible for setting up pin alternate
    functions with configurations of registers. This includes defining the alternate pin registers
    and their bits, as well as the alternate pin selection configurations.

  properties:
    pinmux-group-def:
      type: boolean
      description: Conveys this node is a pinmux group definition.
    pin-reg:
      type: array
      description: |
        The pinmux group definition property.
        The alternate pin registers and their bits. There are a total of 5 registers.
        The register order is from 4 to 0 for convenience in setting the alternate function config
        value, and the maximum bits to configure are 5 (the alternate function config value is 0x1F
        when all register bits are set).
        Set NPCM_PIN_REG_NULL for an empty register.
    alt:
      type: array
      description: |
        The pinmux group definition property.
        The alternate pin selection configurations consist of a total of 6 groups.
        The group order is from 0 to 5, and the bit N value in each group is for
        register N's bit value.
        Set NPCM_PIN_CFG_NULL for an empty configuration.
    id:
      type: array
      description: |
        The pinmux group definition property.
        The pin's index.

  child-binding:
    description: |
      The NPCM pin controller pin configuration group node is responsible for setting pin
      configurations including bias-pull-up, bias-pull-down, pinmux alternate function selection,
      and device control.

    include:
      - name: pincfg-node.yaml
        property-allowlist:
          - bias-pull-down
          - bias-pull-up

    properties:
      pinmux:
        type: array
        description: |
          The pin configuration group property.
          The alternate pin group index and selection of alternate function.
      dev-ctl:
        type: array
        description: |
          The pin configuration group property.
          Configurations of the device control such as tri-state, IO type, and so on.
      periph-pupd:
        type: array
        description: |
          The pin configuration group property.
          A map to the PUPD_ENn register/bit that enables pull-up/down of NPCM peripheral devices.
