# Copyright (c) 2024 Arif Balik <arifbalik@outlook.com>
# SPDX-License-Identifier: Apache-2.0

description: STM32 Tocuh Sensing Controller (TSC) driver

compatible: "st,stm32-tsc"

include: [base.yaml, pinctrl-device.yaml, reset-device.yaml]

properties:
  reg:
    required: true
  clocks:
    required: true
  resets:
    required: true
  interrupts:
    required: true
  pinctrl-0:
    required: true
  pinctrl-names:
    required: true

  pulse-generator-prescaler:
    type: int
    default: 2
    description: |
      Prescaler for the pulse generator clock (t_pgclk=f_hclk/prescaler).
      The prescaler is used to generate the charge transfer pulse.
      0: f_hclk/1
      1: f_hclk/2
      2: f_hclk/4
      3: f_hclk/8
      4: f_hclk/16
      5: f_hclk/32
      6: f_hclk/64
      7: f_hclk/128
    enum: [0, 1, 2, 3, 4, 5, 6, 7]

  ctph:
    type: int
    default: 2
    description: |
      Number of cycles for the high state of the
      charge transfer pulse (1 to 16 cycles of t_pgclk).
    enum: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]

  ctpl:
    type: int
    default: 2
    description: |
      Number of cycles for the low state of the
      charge transfer pulse (1 to 16 cycles of t_pgclk).
    enum: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]

  spread-spectrum:
    type: boolean
    description: Spread spectrum enable

  spread-spectrum-prescaler:
    type: int
    description: Spread spectrum clock prescaler (t_ssclk)
    enum:
      - 1
      - 2

  spread-spectrum-deviation:
    type: int
    default: 1
    description: Spread spectrum deviation (1 to 128 cycles of t_ssclk)

  max-count-value:
    type: int
    default: 5
    description: |
      Max number of charge transfer pulses before max count error is generated.
      0: 255
      1: 511
      2: 1023
      3: 2047
      4: 4095
      5: 8191
      6: 16383
      7: 32767
    enum: [0, 1, 2, 3, 4, 5, 6, 7]

  synced-acquisition:
    type: boolean
    description: |
      Synchronized acquisition enable.
      Acquisition starts when START bit and signal on sync pin.
      You have to provide a pinctrl for the sync pin.

  syncpol-rising:
    type: boolean
    description: Rising synchronization pin polarity, instead of falling

  iodef-float:
    type: boolean
    description: |
      Set default state (not acqusition) of all channel I/Os to floating.
      push-pull down by default.

child-binding:
  description: STM32 TSC group configuration
  properties:
    group:
      type: int
      required: true
      description: Group number (0 to 7)
      enum: [0, 1, 2, 3, 4, 5, 6, 7]

    channel-ios:
      type: int
      description: Channel I/Os to be enabled
      enum: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]

    sampling-io:
      type: int
      required: true
      description: Channel to be selected for sampling
      enum:
        - 1
        - 2
        - 4
        - 8

    use-as-shield:
      type: boolean
      description: |
        Use channel as shield. This configures group but
        does not enable it for acqusition. channel-io is used
        as shield pin and can only have values 1, 2, 4 or 8.

    zephyr,code:
      type: int
      description: |
        This keycode is emmited by the driver to input subsystem
        when acqusition is completed.
